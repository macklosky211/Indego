Extends CharacterState
class_name CharacterSprintState

const JUMP_SPEED : float = 6.0
const STRAFE_SPEED : float = 6.0
const FORWARD_SPEED : float = 10.0
const BACKWARD_SPEED : float = 6.0

const MIN_SLIDE_SPEED : float = 1.5

const DECEL_SPEED : float = 2.5

func _enter() -> void:
	pass

## Velocity '+=' causes Issues (Moving at the speed of light if you hold W forever), I forget how I manage this typically. Setting their velocity '=' would feel stiff...
func _update() -> void:
	if is_holding_jump() and is_on_floor(): velocity.z += JUMP_SPEED
	if is_holding_crouch() and velocity.length() > MIN_SLIDE_SPEED:
		current_state = CharacterSlideState
		return
	
	if not is_holding_sprint(): current_state = CharacterWalkState	

	var input_dir : Vector2 = input_vector()
	
	elif input_dir:
		velocity.x += transform.basis.x * input_dir.x * STRAFE_SPEED
		if input_dir.y > 0: velocity.y += tranform.basis.y * FORWARD_SPEED
		else: velocity.y += transform.basis.y * input_dir.y * BACKWARD_SPEED
	else:
		velocity.x = move_towards(velocity.x, 0, DECEL_SPEED)
		velocity.y = move_towards(velocity.y, 0, DECEL_SPEED)
		if velocity.x == 0 and velocity.y == 0: current_state = CharacterIdleState

func _exit() -> void:
	pass

func _get_state_name() -> String:
	return "Walk"