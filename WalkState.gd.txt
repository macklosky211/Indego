Extends CharacterState
class_name CharacterWalkState

const JUMP_SPEED : float = 4.5
const STRAFE_SPEED : float = 3.0
const FORWARD_SPEED : float = 5.0
const BACKWARD_SPEED : float = 3.0

const DECEL_SPEED : float = 2.5

func _enter() -> void:
	pass

## Velocity '+=' causes Issues (Moving at the speed of light if you hold W forever), I forget how I manage this typically. Setting their velocity '=' would feel stiff...
func _update() -> void:
	if is_holding_jump() and is_on_floor(): velocity.z += JUMP_SPEED
	if is_holding_crouch(): 
		current_state = CharacterCrouchState
		return
	
	var input_dir : Vector2 = input_vector()
	
	if input_dir and is_holding_sprint(): 
		current_state = CharacterSprintState
	elif input_dir:
		velocity.x += transform.basis.x * input_dir.x * STRAFE_SPEED
		if input_dir.y > 0: velocity.y += tranform.basis.y * FORWARD_SPEED
		else: velocity.y += transform.basis.y * input_dir.y * BACKWARD_SPEED
	else:
		velocity.x = move_towards(velocity.x, 0, DECEL_SPEED)
		velocity.y = move_towards(velocity.y, 0, DECEL_SPEED)
		if velocity.x == 0 and velocity.y == 0: current_state = CharacterIdleState

func _exit() -> void:
	pass

func _get_state_name() -> String:
	return "Walk"